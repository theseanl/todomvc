var c,d="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},e;if("function"==typeof Object.setPrototypeOf)e=Object.setPrototypeOf;else{var g;a:{var h={l:!0},k={};try{k.__proto__=h;g=k.l;break a}catch(a){}g=!1}e=g?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var l=e;
function m(a,b){a.prototype=d(b.prototype);a.prototype.constructor=a;if(l)l(a,b);else for(var f in b)if("prototype"!=f)if(Object.defineProperties){var w=Object.getOwnPropertyDescriptor(b,f);w&&Object.defineProperty(a,f,w)}else a[f]=b[f]};var n=Backbone;var p=_;function q(){return n.Model.apply(this,arguments)||this}m(q,n.Model);q.prototype.defaults=function(){return{title:"",completed:!1}};q.prototype.initialize=function(){this.get("title")||this.set({title:this.defaults().title})};q.prototype.toggle=function(){this.save({completed:!this.get("completed")})};q.prototype.clear=function(){this.destroy()};
function r(){var a=n.Collection.apply(this,arguments)||this;a.model=q;a.localStorage=new Store("todos-typescript-backbone");a.comparator=function(b){return b.get("order")};return a}m(r,n.Collection);r.prototype.a=function(){return this.filter(function(a){return a.get("completed")})};function t(){var a=u;return a.length?a.last().get("order")+1:1}var u=new r,v;
function x(a){a=n.View.call(this,a)||this;a.template=p.template($("#item-template").html());p.bindAll(a,"render","close","remove","c");a.model.bind("change",a.render);a.model.bind("destroy",a.remove);a.model.bind("visible",a.c);return a}m(x,n.View);c=x.prototype;c.preinitialize=function(){this.tagName="li"};c.events=function(){return y({A:"click .check",s:"dblclick label.todo-content",clear:"click button.destroy",B:"keypress .edit",u:"keydown .edit",close:"blur .edit"})};
c.render=function(){this.$el.html(this.template(this.model.toJSON())).toggleClass("completed",this.model.get("completed"));this.c();this.input=this.$(".todo-input");return this};c.A=function(){this.model.toggle()};c.c=function(){var a=this.model.get("completed");this.$el.toggleClass("hidden","completed"===v&&!a||"active"===v&&a)};c.s=function(){this.$el.addClass("editing");this.input.focus()};c.close=function(){var a=this.input.val().trim();a?this.model.save({title:a}):this.clear();this.$el.removeClass("editing")};
c.B=function(a){a.which===z&&this.close()};c.u=function(a){a.which===A&&(this.$el.removeClass("editing"),this.input.val(this.model.get("title")))};c.clear=function(){this.model.clear()};var z=13,A=27;function B(){var a=n.Router.call(this)||this;a.routes={"*filter":"v"};a._bindRoutes();return a}m(B,n.Router);B.prototype.v=function(a){u.trigger("filter",void 0===a?"":a)};
function C(){var a=n.View.call(this)||this;a.setElement($(".todoapp"),!0);p.bindAll(a,"b","addAll","render","j","filter");a.input=a.$(".new-todo");a.f=a.$(".toggle-all")[0];a.i=a.$(".main")[0];a.h=a.$(".footer")[0];a.w=p.template($("#stats-template").html());u.bind("add",a.b);u.bind("reset",a.addAll);u.bind("all",a.render);u.bind("change:completed",a.g);u.bind("filter",a.filter);u.fetch();new B;n.history.start();return a}m(C,n.View);c=C.prototype;
c.events=function(){return y({o:"keypress .new-todo",m:"click .todo-clear button",j:"click .toggle-all"})};
c.render=function(){var a=u.a().length,b=u;b=b.without.apply(b,b.a()).length;u.length?(this.i.style.display="block",this.h.style.display="block",this.$(".todo-stats").html(this.w({total:u.length,completed:a,remaining:b})),this.$(".filters li a").removeClass("selected").filter('[href="#/'+(v||"")+'"]').addClass("selected")):(this.i.style.display="none",this.h.style.display="none");this.f.checked=!b;return this};c.b=function(a){a=new x({model:a});this.$(".todo-list").append(a.render().el)};
c.addAll=function(){u.each(this.b)};c.filter=function(a){v=a;u.each(this.g)};c.g=function(a){a.trigger("visible")};c.o=function(a){a.which===z&&this.input.val().trim()&&(u.create({title:this.input.val().trim(),order:t(),a:!1}),this.input.val(""))};c.m=function(){p.each(u.a(),function(a){return a.clear()});return!1};c.j=function(){var a=this.f.checked;u.each(function(b){return b.save({completed:a})})};function y(a){var b={},f;for(f in a)b[a[f]]=f;return b}$(function(){new C});
